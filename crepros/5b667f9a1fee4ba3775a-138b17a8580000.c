// https://syzkaller.appspot.com/bug?id=4023dcf7b4456b73d1927d1e755ec6b180565e5f
// autogenerated by syzkaller (https://github.com/google/syzkaller)

#define _GNU_SOURCE

#include <endian.h>
#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/syscall.h>
#include <sys/types.h>
#include <unistd.h>

int main(void)
{
  syscall(__NR_mmap, /*addr=*/0x3ffffffff000ul, /*len=*/0x1000ul, /*prot=*/0ul,
          /*flags=MAP_FIXED|MAP_ANONYMOUS|MAP_PRIVATE*/ 0x32ul, /*fd=*/-1,
          /*offset=*/0ul);
  syscall(__NR_mmap, /*addr=*/0x400000000000ul, /*len=*/0x1000000ul,
          /*prot=PROT_WRITE|PROT_READ|PROT_EXEC*/ 7ul,
          /*flags=MAP_FIXED|MAP_ANONYMOUS|MAP_PRIVATE*/ 0x32ul, /*fd=*/-1,
          /*offset=*/0ul);
  syscall(__NR_mmap, /*addr=*/0x400001000000ul, /*len=*/0x1000ul, /*prot=*/0ul,
          /*flags=MAP_FIXED|MAP_ANONYMOUS|MAP_PRIVATE*/ 0x32ul, /*fd=*/-1,
          /*offset=*/0ul);
  const char* reason;
  (void)reason;
  if (write(1, "executing program\n", sizeof("executing program\n") - 1)) {
  }
  memcpy((void*)0x4000000000c0, "./bus\000", 6);
  syscall(__NR_mkdir, /*path=*/0x4000000000c0ul, /*mode=S_IXUSR*/ 0x40ul);
  memcpy((void*)0x400000000100, "syz\000", 4);
  memcpy((void*)0x400000000380, "./bus\000", 6);
  memcpy((void*)0x4000000003c0, "9p\000", 3);
  syscall(__NR_mount, /*src=*/0x400000000100ul, /*dst=*/0x400000000380ul,
          /*type=*/0x4000000003c0ul,
          /*flags=MS_I_VERSION|MS_POSIXACL|MS_REC|MS_NODEV*/ 0x814004ul,
          /*opts=*/0ul);
  memcpy((void*)0x400000000000, "./bus\000", 6);
  memcpy((void*)0x400000000040, "system.posix_acl_default\000", 25);
  *(uint32_t*)0x400000000480 = 2;
  *(uint16_t*)0x400000000484 = 1;
  *(uint16_t*)0x400000000486 = 0;
  *(uint32_t*)0x400000000488 = 0;
  *(uint16_t*)0x40000000048c = 4;
  *(uint16_t*)0x40000000048e = 0;
  *(uint32_t*)0x400000000490 = 0;
  *(uint16_t*)0x400000000494 = 0x10;
  *(uint16_t*)0x400000000496 = 6;
  *(uint32_t*)0x400000000498 = 0;
  *(uint16_t*)0x40000000049c = 0x20;
  *(uint16_t*)0x40000000049e = 0;
  *(uint32_t*)0x4000000004a0 = 0;
  syscall(__NR_setxattr, /*path=*/0x400000000000ul, /*name=*/0x400000000040ul,
          /*val=*/0x400000000480ul, /*size=*/0x24ul,
          /*flags=XATTR_REPLACE|XATTR_CREATE*/ 3ul);
  memcpy((void*)0x400000000080, "./bus\000", 6);
  syscall(__NR_chdir, /*dir=*/0x400000000080ul);
  memcpy((void*)0x4000000000c0, "./bus\000", 6);
  syscall(__NR_mkdir, /*path=*/0x4000000000c0ul, /*mode=S_IXUSR*/ 0x40ul);
  return 0;
}
