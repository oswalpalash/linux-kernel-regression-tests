// https://syzkaller.appspot.com/bug?id=47982c8ccf5d31f14e8a173a5982667b36616bc6
// autogenerated by syzkaller (https://github.com/google/syzkaller)

#define _GNU_SOURCE

#include <endian.h>
#include <sched.h>
#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/syscall.h>
#include <sys/types.h>
#include <unistd.h>

#ifndef __NR_memfd_create
#define __NR_memfd_create 319
#endif

#define USLEEP_FORKED_CHILD (3 * 50 * 1000)

static long handle_clone_ret(long ret)
{
  if (ret != 0) {
    return ret;
  }
  usleep(USLEEP_FORKED_CHILD);
  syscall(__NR_exit, 0);
  while (1) {
  }
}

static long syz_clone(volatile long flags, volatile long stack,
                      volatile long stack_len, volatile long ptid,
                      volatile long ctid, volatile long tls)
{
  long sp = (stack + stack_len) & ~15;
  long ret = (long)syscall(__NR_clone, flags & ~CLONE_VM, sp, ptid, ctid, tls);
  return handle_clone_ret(ret);
}

uint64_t r[1] = {0xffffffffffffffff};

int main(void)
{
  syscall(__NR_mmap, 0x1ffff000ul, 0x1000ul, 0ul, 0x32ul, -1, 0ul);
  syscall(__NR_mmap, 0x20000000ul, 0x1000000ul, 7ul, 0x32ul, -1, 0ul);
  syscall(__NR_mmap, 0x21000000ul, 0x1000ul, 0ul, 0x32ul, -1, 0ul);
  intptr_t res = 0;
  memcpy(
      (void*)0x20000a40,
      "Y\377\377\000\000\000\000\000K\262\002\200B\351\350\314\336\006\000l\250"
      "\032J\257\262M\272\270_\005U\315<|>\236\354^\016\276\030+-"
      "\233\2113\002\000\246\037+"
      "\263\305\220z5\340\337i\267\237\264QW\311\311\222\003\t\000\000\000\000"
      "\000\262\017\356\276\f8\314\177\000\000\000Z\201\000\000\000\000\030I"
      "\023\361\242x\004\201R\3245R\256\204\315N\367\366\b~\355_M^dQ:"
      "\274\257q\210\031nSF|;]\341A\214\212\230\327|\334LF\r\261\375\277!"
      "\307u\314P\335\023~\211\317\205\312\240%"
      "\306\307\021\000\000\000\000\000\000\000?M9\\\av~\'\331\260\254dya]"
      "8\235\267\v\3639\305{\234!\017/"
      "\270o8\271\215\031\342\312\001y\203\347\ng\207\3313<"
      "u\276\352g\322\004e\362s\336}o#\220\332\234s,r\375:"
      "\313\307\vTmPZJ\254\213\320\300\274RK\313\0368\316\275[N\260\264<"
      "\353\206[\354\217\024\n\203\236&\\\267!\355\240\303,"
      "\220m\017\000\000\000\000\000\000\377\320\263\224\000\000\000\000\000"
      "\000\000\235H\370\377Ro\243W\341\355\216S\256X\223\177\323\271a\344\340"
      "\275\331\365\344e\371\312m\343\003\344\255\325&"
      "A\002\310\251\376\313\207\331\323\214\f\275\220?\037\234\2330\031 "
      "\237\321p`\300/"
      "\000u\031\035\254\350%"
      "\267\t\2374\273\211\351\301\201\260\326\367\005\026\271\351\334~\323-"
      "s\346;\224\034^\006\332v;\314D\225sj\340\325\276S\254\345N\352\236yl[["
      "\3165\356\005\234\226\253J^b\367\031\264\330\344\207\235p\352?/"
      "\313\232\2525\'Q\f\027`\201\212@\227M=v\376\a\253p\363\223\235\177@"
      "9\300\322\361#\347N\211\370\350+"
      "\241\202\003\262\251\357\245\370\213k\263\236v\222\016\321\037\027Dx["
      "\255\260\235/"
      "\226\3442mO\237h\352\363\024\315\226\211_)\033\342\326\b\224b\257;"
      "\222T\257z\224\237G\373\375|$k\003\327;\232y\356\371W?\263\371\370I."
      "E4\303eWq\372\":$\320\027Q\224\365\345mk\216&\361;#z\357*"
      "\316\231\004\271\220\274\271#-"
      "\215i\256\305\337\023\322K\213\365\f\262x\335\325\264\251^~O<"
      "\022\343\303P|7\251\310\261r0Z\230\207^"
      "\310C\033\226\264lsyF\305\274\377OE\351\3270\347\376p\203\247\241\331"
      "\344\272\222\027\277\340\341\001\267\213\030j\031n\310\377\351\364\364"
      "\317 "
      "a\327_w\017\235F\256\314A-/"
      "\203\253\025\325\2778\244O\264\357\310\314H\321=\276\265O\025\307;"
      "Lb\316\032\314\230\350\351e\340\302N\347\327\035\222\207F8\236\367\335"
      "\332W\365X\200\240f\316o\330\177\300\226\bSB\316&\004$"
      "\303\3431U\204\202\360{i\035\002\020\306C\001^\317\223?"
      "w\001\204\240\326\242\020\244\374G\253D\326dGZ\262Cx\033\375D93\346\312u"
      "M\343\005)\342[\342j$F1n@\336\n%t.[\255\265\f<"
      "o\333\244\220\304\320I\246\226\241\000\273\335\224\000t/"
      "1YekG\177\275rI\036\2124=\242\351\3701\255\356\365\244\005#"
      "\177\250\037\024\202ih\371?\003Q\365\304\225\231 "
      "\247v~:$"
      "\002O\343\252\360o\353k\'\322\t\000\036\224n\327w\261\200\020x\277\n0\b,"
      "r\306r\367=\376\301\026\346\356\273:-h\272\213\024\232?\216\003;"
      "\345\004\330\251\232\323E(\177|\255U\257e\207V.i4$6U,R\233\n{"
      "\'\3761\304\2609e\274\371\000\260E\024\030\311\370!}D-\326F\343\371kK_"
      "\376\272\325\277x\354\345cw9c\263k\311\222h\366g\343\223;"
      "\250\027\205\243\217\374\317w9\030\251S\342\367\346\315\000\000\000\000"
      "\212+\026\373\376\025\264\001\374\017ch`\221q\341\211 "
      "\320\242<^\215\267\210\234\3746\251\207\340<"
      "\261\316\335\334I\252n\221\002Z\016\234\375eV\217\226="
      "\031\272\030\233\275\376L\237d&"
      "\310\020s\217W\'U\347\211\034f7\020\000\264a\275\357\3073\037~"
      "\325\207\254q4\322\034:\212\213\264\350\226R\335/"
      "\026\206\242\331\376\337\t\270\366\260\350k\276\323\254*\221\037>\351>~"
      "\223\321\267\036h\025\227pm\217\224\\\325\b\236\f\200\217\370\2625\247"
      "\256\2043b\230\260;\f\340}\375\tY5\324|\273|\262\276\377\263EM\031\237)"
      "\212==V\001\025\r\214\270\032\000\000\000\000\000\005,"
      "\027i\252\351\037G\356\344\2200@"
      "\351\250\253\273\254ZZ\025\023\002\003\236e!"
      "z\354\337\214Z\2071\335\035\337\207\247\223\321\320\327\350\321\234\001"
      "\341\316n\005Th^c\325\255$0\371\2466\210C/"
      "e@"
      "\017xKAN\326\016\256\312\266\2757\355\271\275\235\225\333\213\252\3308\b"
      "(\r\001\016\203\223a\365M\346\271t2\355\000\231LD\221\354\373\333\004"
      "\216\275a\363\t|\020\241\177G\221\331\360\207)"
      "J\202\350\037\b\335\000\273uWt\240]\336r\\E\214,7v[>"
      "\223\003\016\205\314j5B\330\375\305X\322\000\000\000\000\000\000\345\327"
      "8\334\367\200Kt\247[d+\322\022\365\327\222q\311\\g\374\342v\345\356="
      "\2747\224\"\355\260\207\232\312}\230\341W\277\r\310\344y",
      1405);
  res = syscall(__NR_memfd_create, 0x20000a40ul, 6ul);
  if (res != -1)
    r[0] = res;
  syscall(__NR_mmap, 0x20200000ul, 0x400000ul, 0xbul, 0x2012ul, r[0], 0ul);
  syz_clone(0, 0, 0, 0, 0, 0);
  syscall(__NR_mlock, 0x20308000ul, 0x3000ul);
  return 0;
}
